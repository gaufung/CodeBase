% -*- coding:utf-8 -*-
\documentclass{standalone}
\usepackage{fontspec}
\setmainfont{Times New Roman}
\usepackage[UTF8]{ctex}
\usepackage{tikz}
\usepackage{amsmath}
\usetikzlibrary{matrix,calc,shapes,backgrounds,patterns,positioning,decorations.pathreplacing}
\begin{document}
\begin{tikzpicture}
\draw[rounded corners=1mm] (0,0) rectangle (1.5,1) node[align=center, font=\tiny] at(0.75,0.5) {人口流动网络图 \\ Graph};
\draw[fill=none, draw] (2.5,1.5) rectangle (4,2.5) node[align=center, font=\tiny] at (3.25, 2) {发送消息至 \\ 目的节点};
\draw[fill=none, draw] (2.5,-1.5) rectangle (4, -0.5) node[align=center,font=\tiny] at (3.25, -1){发送消息至 \\ 源节点};
\draw[ ->] (1.5, 0.5) -- (2.5, 2) node[pos=0.5, sloped, above]{map};
\draw[->] (1.5, 0.5) -- (2.5, -1) node[pos=0.5, sloped, below]{map};
\draw (5,1.5) rectangle (6.5, 2.5) node[align=center, font=\tiny] at (5.75, 2) {人口流动 \\ 求和};
\draw (5,-1.5) rectangle (6.5, -0.5) node[align=center, font=\tiny] at (5.75, -1) {人口流动 \\ 求和};
\draw[->] (4,2) -- (5, 2) node[pos=0.5, sloped, above,font=\small]{reduce};
\draw[->] (4,-1) -- (5, -1) node[pos=0.5, sloped, above,font=\small]{reduce};
\draw (7.5, 1.5) rectangle (9,2.5) node[align=center, font=\tiny] at (8.25, 2) {城市人口 \\ 流入量 $\delta_i$};
\draw (7.5, -1.5) rectangle (9,-0.5) node[align=center, font=\tiny] at (8.25, -1) {城市人口 \\ 流出量 $\omega_i$};
\draw[->] (6.5, 2) -- (7.5,2);
\draw[->] (6.5, -1) -- (7.5,-1);
\draw[rounded corners=1mm] (10.5,0) rectangle (12,1) node[align=center, font=\tiny] at (11.25, 0.5){城市人口 \\ 流入流出比$\psi_i$};
\draw[-] (9,2) -- (9.75, 0.5);
\draw[-] (9,-1) -- (9.75,0.5);
\draw[->] (9.75, 0.5) -- (10.5, 0.5) node[pos=0.5, above, font=\small] {join};
\end{tikzpicture}
\end{document}