% -*- coding:utf-8 -*-
\documentclass{standalone}
\usepackage{fontspec}
\setmainfont{Times New Roman}
\usepackage[UTF8]{ctex}
\usepackage{tikz}
\usepackage{amsmath}
\usetikzlibrary{matrix,calc,shapes,backgrounds,patterns,positioning,decorations.pathreplacing}
\begin{document}
\begin{tikzpicture}
[Nodelabel/.style={rectangle, rounded corners=2mm, draw=black}]
\draw[thick] (0,0) rectangle (3,2) node[color=black] at (1.5,1.6) {DataNode};
\draw[thick] (6,0) rectangle (9, 2) node[color=black] at (7.5, 1.6){DataNode};
\node[Nodelabel] at (1.5, -0.5) {Rack1} ;
\node[Nodelabel] at (7.5, -0.5) {Rack2} ;
% draw the inner block
\draw (0.2, 0.2) rectangle (2.8, 1.3);
\draw (6.2, 0.2) rectangle (8.8, 1.3);
\draw[rounded corners=1mm,pattern=crosshatch , pattern color=darkgray!100] (0.3, 0.3) rectangle (1.4, 1.0);
\draw[rounded corners=1mm,pattern= grid, pattern color=lightgray!50] (1.6, 0.5) rectangle (2.7, 1.2);
\draw[rounded corners=1mm,pattern=crosshatch, pattern color=darkgray!100] (6.3, 0.3) rectangle (7.4, 1.0);
\draw[rounded corners=1mm,pattern=grid, pattern color=lightgray!50] (7.6, 0.5) rectangle (8.7, 1.2);
% draw the double arrow between rack1 and rack2
\draw [thick, <->] (3.2,1) -- (5.8,1);
\node[Nodelabel] at (4.5, 0.5) {Replication};

% draw the client
\draw (0, 4) ellipse (1 and 0.5) node at (0,4) {Client};
\draw[rounded corners=2mm] (4.5-1.25, 5-0.5) rectangle (4.5+1.25, 5+0.5) node at (4.5, 5) {NameNode};
\draw (9-1.25, 5-0.5) rectangle (9+1.25, 5+0.5) node at (9, 5) {存储元数据};
\draw[rounded corners=2mm] (10.5-1.25, 3-0.5) rectangle (10.5+1.25, 3+0.5) node at (10.5,3)[align=center] {Secondary \\ NameNode};

% draw the flow lines
%\draw[thick, ->] (0,3.5) -- (1.5,2);
\draw[thick, ->] (0,3.5) .. controls (0.1, 3) and (1.4, 2.5) ..(1.5,2) node[pos = 0.6,sloped, above] {读写数据};
\draw[thick, ->] (0,4.5) .. controls (1.6, 5)  .. (3.25, 5) node[pos=0.5, sloped, above] {读取元数据};
\draw[thick, ->] (5.75, 5) -- (7.75, 5);
\draw[thick, ->] (4.5, 4.5) .. controls (4.6,3.7) and (7.4, 2.8) .. (7.5,2) node[pos=.5, sloped, above]{管理数据};
\draw[thick, -> ] (9, 4.5) .. controls (9.2, 4.2) and (10.3, 3.9) .. (10.5, 3.5) node[pos=0.7,sloped, above]{备份};
\end{tikzpicture}
\end{document}